<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SQL DML - Learning Programming Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The example book covers examples.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/pagetoc.css">
        <!-- MathJax -->
        <!-- <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        <script async type="text/javascript" src="theme/MathJax.js"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../prefix.html">Prefix</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">程序设计语言</li><li class="chapter-item expanded "><a href="../Python/Python编程基础.html">Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Python/Python编程基础.html">编程基础</a></li><li class="chapter-item expanded "><a href="../Python/Python开发环境.html">开发环境</a></li><li class="chapter-item expanded "><a href="../Python/Python数据类型.html">数据类型</a></li><li class="chapter-item expanded "><a href="../Python/Python输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../Python/Python编程应用.html">编程应用</a></li><li class="chapter-item expanded "><a href="../Python/Python数值计算.html">数值计算</a></li><li class="chapter-item expanded "><a href="../Python/Python系统编程.html">系统编程</a></li><li class="chapter-item expanded "><a href="../Python/Python高级编程.html">高级编程</a></li></ol></li><li class="chapter-item expanded "><a href="../Java/JAVA编程基础.html">Java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Java/JAVA编程基础.html">编程基础</a></li><li class="chapter-item expanded "><a href="../Java/Java开发环境.html">开发环境</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Java/Maven POM.html">Maven 配置</a></li></ol></li><li class="chapter-item expanded "><a href="../Java/JAVA数据类型.html">数据类型</a></li><li class="chapter-item expanded "><a href="../Java/JAVA输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../Java/JAVA系统编程.html">系统编程</a></li><li class="chapter-item expanded "><a href="../Java/Scala.html">Scala</a></li><li class="chapter-item expanded "><a href="../Java/ScalaFrameworks.html">Scala 框架</a></li></ol></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp编程基础.html">C#/.NET</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp编程基础.html">编程基础</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp数据容器.html">数据容器</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp数值计算.html">数值计算</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/dotnet开发.html">.NET 开发</a></li></ol></li><li class="chapter-item expanded "><a href="../CC++/Modern C++.html">C and C++</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../CC++/Modern C++.html">Modern C++</a></li><li class="chapter-item expanded "><a href="../CC++/C++开发环境.html">开发环境</a></li><li class="chapter-item expanded "><a href="../CC++/C++容器.html">数据容器</a></li><li class="chapter-item expanded "><a href="../CC++/输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../CC++/标准函数库.html">标准库</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../CC++/数学函数.html">数学函数</a></li></ol></li></ol></li><li class="chapter-item expanded "><div>Web开发</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../JavaScript/JavaScript.html">JavaScript</a></li><li class="chapter-item expanded "><a href="../JavaScript/TypeScript.html">TypeScript</a></li><li class="chapter-item expanded "><a href="../JavaScript/JS开发环境.html">开发环境</a></li></ol></li><li class="chapter-item expanded "><div>开发工具</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../开发环境/git.html">Git</a></li><li class="chapter-item expanded "><a href="../笔记/正则表达式.html">正则表达式</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">操作系统</li><li class="chapter-item expanded "><a href="../Linux/Linux配置和管理.html">Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Linux/Linux配置和管理.html">配置管理</a></li><li class="chapter-item expanded "><a href="../Linux/Linux-Shell.html">Shell Script</a></li><li class="chapter-item expanded "><a href="../Linux/Linux发行版.html">Linux 发行版</a></li><li class="chapter-item expanded "><a href="../Linux/操作系统原理.html">操作系统原理</a></li></ol></li><li class="chapter-item expanded "><a href="../Windows/Windows配置管理.html">Windows</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Windows/Windows配置管理.html">配置管理</a></li><li class="chapter-item expanded "><a href="../Windows/Windows Shell.html">Shell</a></li><li class="chapter-item expanded "><a href="../Windows/Windows Applications.html">应用软件</a></li></ol></li><li class="chapter-item expanded "><div>应用软件</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../应用软件/程序开发软件.html">程序开发</a></li><li class="chapter-item expanded "><a href="../应用软件/服务器管理软件.html">服务器管理</a></li><li class="chapter-item expanded "><a href="../应用软件/网络访问软件.html">网络访问</a></li><li class="chapter-item expanded "><a href="../应用软件/网络服务软件.html">网络服务</a></li><li class="chapter-item expanded "><a href="../应用软件/文档生成软件.html">文档生成</a></li><li class="chapter-item expanded "><a href="../应用软件/文件处理软件.html">文件处理</a></li><li class="chapter-item expanded "><a href="../应用软件/协作办公软件.html">协作办公</a></li><li class="chapter-item expanded "><a href="../应用软件/知识管理软件.html">知识管理</a></li><li class="chapter-item expanded "><a href="../应用软件/多媒体编辑软件.html">多媒体编辑</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">机器学习</li><li class="chapter-item expanded "><a href="../机器学习/机器学习实践.html">机器学习实践</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../机器学习/ScikitLearn.html">scikit-learn</a></li><li class="chapter-item expanded "><a href="../机器学习/TensorFlow.html">TensorFlow</a></li><li class="chapter-item expanded "><a href="../机器学习/Pytorch.html">Pytorch</a></li><li class="chapter-item expanded "><a href="../机器学习/图神经网络.html">图神经网络</a></li></ol></li><li class="chapter-item expanded "><a href="../机器学习/机器学习原理与算法.html">原理与算法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../机器学习/统计学习算法.html">统计学习算法</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">数据库</li><li class="chapter-item expanded "><a href="../数据库/SQL语法.html">SQL</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../数据库/SQL DDL.html">SQL DDL</a></li><li class="chapter-item expanded "><a href="../数据库/SQL DML.html" class="active">SQL DML</a></li><li class="chapter-item expanded "><a href="../数据库/SQL数据类型.html">数据类型</a></li></ol></li><li class="chapter-item expanded "><a href="../数据库/MySQL.html">MySQL</a></li><li class="chapter-item expanded "><a href="../数据库/PostgreSQL.html">PostgreSQL</a></li><li class="chapter-item expanded "><a href="../数据库/HiveSQL.html">Hive SQL</a></li><li class="chapter-item expanded "><a href="../数据库/Elasticsearch.html">Elasticsearch</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../数据库/Elastic Datasource.html">数据源</a></li></ol></li><li class="chapter-item expanded "><a href="../数据库/Mongodb.html">Mongodb</a></li><li class="chapter-item expanded "><a href="../数据库/GraphDatabase.html">图数据库</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">服务和大数据平台</li><li class="chapter-item expanded "><a href="../服务器/分布式大数据处理.html">分布式大数据处理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../服务器/CDH6大数据集群离线安装.html">CDH6 安装教程</a></li><li class="chapter-item expanded "><a href="../服务器/Spark Python API.html">Pyspark</a></li><li class="chapter-item expanded "><a href="../服务器/流数据处理.html">流数据处理</a></li></ol></li><li class="chapter-item expanded "><a href="../服务器/容器编排.html">容器编排</a></li><li class="chapter-item expanded "><a href="../服务器/虚拟化.html">虚拟化</a></li><li class="chapter-item expanded "><div>任务编排</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../服务器/Airflow.html">Airflow</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">其他</li><li class="chapter-item expanded "><div>数据标记语言</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../数据交换语言/JSON and YAML.html">JSON and YAML</a></li><li class="chapter-item expanded "><a href="../数据交换语言/XML.html">XML</a></li><li class="chapter-item expanded "><a href="../数据交换语言/HTML.html">HTML</a></li></ol></li><li class="chapter-item expanded "><div>网络协议</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Protocols/http.html">HTTP</a></li><li class="chapter-item expanded "><a href="../Protocols/DNS.html">DNS</a></li><li class="chapter-item expanded "><a href="../Protocols/端口分配.html">端口分配</a></li><li class="chapter-item expanded "><a href="../Protocols/IP protocol numbers.html">IP 承载协议</a></li><li class="chapter-item expanded "><a href="../Protocols/RPC.html">RPC</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Learning Programming Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="数据操作语言"><a class="header" href="#数据操作语言">数据操作语言</a></h1>
<blockquote>
<p>Data Manipulation Languages.</p>
</blockquote>
<h2 id="修改数据表"><a class="header" href="#修改数据表">修改数据表</a></h2>
<h3 id="插入数据记录"><a class="header" href="#插入数据记录">插入数据记录</a></h3>
<pre><code class="language-sql">INSERT INTO table_name [(col_name,...)]
                 VALUES (col_value,...),(...),...
                 WHERE conditions;
</code></pre>
<blockquote>
<p><code>MySQL</code>可省略<code>INTO</code>关键字。</p>
<p>如果未指定列名，则需按列定义顺序给出所有列的值；反之，只需给出指定的列名对应的值（未指定的列的值为<code>NULL</code>）。</p>
<p>非数值类型：使用单引号包含起来，以免发生错误。</p>
</blockquote>
<h3 id="批量插入记录"><a class="header" href="#批量插入记录">批量插入记录</a></h3>
<h4 id="从表格复制"><a class="header" href="#从表格复制">从表格复制</a></h4>
<pre><code class="language-mysql">INSERT INTO target_table (SELECT * from source_table);
</code></pre>
<h3 id="替换数据记录"><a class="header" href="#替换数据记录">替换数据记录</a></h3>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replace.html"><code>REPLACE</code></a> works exactly like <a href="https://dev.mysql.com/doc/refman/8.0/en/insert.html"><code>INSERT</code></a>, except that if an old row in the table has the same value as a new row for a <code>PRIMARY KEY</code> or a <code>UNIQUE</code> index, the old row is deleted before the new row is inserted.</p>
<pre><code class="language-mysql">REPLACE INTO table_name [(col_name,...)]
                 VALUES (col_value,...),(...),...;
</code></pre>
<pre><code class="language-mysql">INSERT IGNORE table_name ...;
</code></pre>
<blockquote>
<p>忽略导致错误的行，并将其余行插入到表中。</p>
</blockquote>
<h3 id="更新记录字段"><a class="header" href="#更新记录字段">更新记录字段</a></h3>
<p>将满足条件的表项的字段值更新为设定值。</p>
<pre><code class="language-sql">UPDATE table_name 
SET col_name1=value1[, col_name2=expr1] ...
[WHERE where_condition]
</code></pre>
<h3 id="删除数据记录"><a class="header" href="#删除数据记录">删除数据记录</a></h3>
<h4 id="删除单表记录"><a class="header" href="#删除单表记录">删除单表记录</a></h4>
<pre><code class="language-sql">DELETE FROM tbl_name [WHERE where_condition];
</code></pre>
<h5 id="清空表内容"><a class="header" href="#清空表内容">清空表内容</a></h5>
<pre><code class="language-sql">TRUNCATE TABLE tbl_name -- 类似于使用`DELETE`删除所有记录。
</code></pre>
<p>如果该表有外键约束，则可临时禁用外键约束再清空表内容（可能破坏关联表的数据完整性，需要同时处理相关表）。</p>
<pre><code class="language-mysql">SET FOREIGN_KEY_CHECKS = 0; -- 当前会话禁用约束检查
</code></pre>
<h4 id="删除多表的记录"><a class="header" href="#删除多表的记录">删除多表的记录</a></h4>
<pre><code class="language-sql">DELETE tbl_name[.*] [, tbl_name[.*]] ...
FROM   table_references
[WHERE where_condition];
</code></pre>
<p>示例：</p>
<pre><code class="language-sql">DELETE t1,t2 FROM store_info t1,store_geo t2 where t1.store_name='Boston' AND t2.store_name='Boston';
</code></pre>
<p>注意多表时，<code>FROM</code>后面如果使用了表的别名，则<code>DELETE</code>之后也要使用表的别名，否则会出现错误。
无论是单表还是多表，如果不加<code>WHERE</code>作为条件限制将会导致表的记录全部被删除，因此要小心。</p>
<h2 id="查询数据"><a class="header" href="#查询数据">查询数据</a></h2>
<p>查询使用<code>SELECT</code>命令。一般语法：https://dev.mysql.com/doc/refman/8.0/en/select.html。</p>
<pre><code class="language-sql">SELECT [DISTINCT] field1, field2 AS Name, FUNC(field3), ...
   FROM table_reference 
   [WHERE condition]
   [GROUP BY col_list]
   [ORDER BY col_list]
   [CLUSTER BY col_list | [DISTRIBUTE BY col_list] [SORT BY col_list] ]
   [LIMIT [offset], num_rows];
</code></pre>
<p>使用<code>*</code>代替字段名称，用于查询所有列，<code>AS</code>为返回结果的变量设置列名。查询语句中不仅可以直接使用变量，也可以<a href="#%E8%BF%90%E7%AE%97">将函数应用于查询字段或条件中的字段</a>。</p>
<p><code>SELECT DISTINCT</code>关键字用于<strong>查询不重复的记录</strong>。</p>
<h3 id="条件过滤"><a class="header" href="#条件过滤">条件过滤</a></h3>
<p>通常基于字段的值构造逻辑表达式，表达式<strong>返回结果长度与表格行数</strong>一致（返回结果也可以是标量）。</p>
<pre><code class="language-sql">SELECT * FROM store_info WHERE sales&lt;1000;
SELECT * FROM Customers WHERE Country='Germany' AND (City='Berlin' OR City='München');
</code></pre>
<p>条件表达式可以使用比较运算符：“<code>=</code>”（等于）、“<code>&gt;</code>”、“<code>&lt;</code>”、“<code>&gt;=</code>”、“<code>&lt;=</code>”、“<code>!=</code>”/“<code>&lt;&gt;</code>”（不等于）。</p>
<blockquote>
<p>不支持“<code>==</code>”。</p>
</blockquote>
<p>空值判断运算符：<code>IS NULL</code>和<code>IS NOT NULL </code>，空值不支持比较运算符。</p>
<p>时间日期字段可以和字面值进行比较：<code>start_time&gt;='2021-11-01'</code>。</p>
<p><strong>注意</strong>：条件过滤的执行先于<code>SELECT</code>，因此在<code>SELECT</code>语句中声明的查询结果别名无法在<code>WHERE</code>语句中使用。如果查询条件需要用到<code>SELECT</code>计算出的列，可先执行[子查询](# 查询表引用子查询结果)，再从子查询结果中指定过滤条件再次查询。</p>
<h5 id="复合条件"><a class="header" href="#复合条件">复合条件</a></h5>
<p>多个表达式之间还可以使用 <code>AND</code>、<code>OR</code>和<code>NOT</code>等逻辑运算符进行多条件联合查询。</p>
<h4 id="模糊查询"><a class="header" href="#模糊查询">模糊查询</a></h4>
<pre><code class="language-sql">SELECT * FROM table_name WHERE columnN LIKE pattern;
</code></pre>
<p><code>pattern</code>支持通配符：</p>
<ul>
<li><code>%</code>：零个或多个字符；</li>
<li><code>_</code>：一个字符；</li>
<li><code>[]</code>：任何一个在括号中的字符，<code>[^abc]</code>任何不在括号中的字符，<code>[a-z]</code>指定字符区间。</li>
</ul>
<blockquote>
<p>Hive：<code>LIKE</code>支持函数式调用<code>LIKE(A,B)</code>。</p>
</blockquote>
<h4 id="正则表达式"><a class="header" href="#正则表达式">正则表达式</a></h4>
<blockquote>
<p>MySQL需要8.0版本支持。</p>
</blockquote>
<h5 id="正则表达式函数"><a class="header" href="#正则表达式函数">正则表达式函数</a></h5>
<p><code>REGEXP_LIKE(expr, pat[, match_type])</code>：匹配返回1，否则返回0；若参数为<code>NULL</code>，则返回<code>NULL</code>；<code>REGEXP</code>和<code>RLIKE</code>是作为运算符的同义词，即</p>
<pre><code class="language-sql">key REGEXP pattern
expr NOT_REGEXP pattern, NOT (expr REGEXP pattern)
</code></pre>
<blockquote>
<p>Hive: <code>REGEXP</code> , <code>RLIKE</code>返回<code>true|false|null</code>，同时也支持函数式调用。</p>
</blockquote>
<p><code>REGEXP_SUBSTR(expr, pat[, pos[, occurrence[, match_type]]])</code></p>
<blockquote>
<p><code>pos</code>：匹配起始位置，默认为1；
<code>occurrence</code>：<em>表示返回匹配的序号，默认0表示返回全部匹配</em>；</p>
<p>Hive语法为：<code>REGEXP_EXTRACT(colname, 'pattern', index)</code>，其中<code>index</code>为0表示返回匹配结果，<code>index&gt;0</code>表示返回对应的捕获组。</p>
</blockquote>
<pre><code class="language-sql">select REGEXP_SUBSTR(store_name, '10\.12.*') from test_type 
	where store_name REGEXP '10\.12.*';
</code></pre>
<p><code>REGEXP_REPLACE(expr, pat, repl[, pos[, occurrence[, match_type]]])</code></p>
<h3 id="排序和限制"><a class="header" href="#排序和限制">排序和限制</a></h3>
<pre><code class="language-mysql">SELECT * FROM table_name 
    ORDER BY field1 [DESC|ASC],field2 [DESC|ASC]...
    LIMIT [offset_start,] row_count ;
</code></pre>
<p>根据给出字段，对选出的查询记录进行排序，可以指定升序或降序。如果排序后只希望显示结果的一部分，则可以使用<code>limit</code>关键字来实现。	</p>
<p>记录的索引是从0开始的，如果没有声明<code>offset_start</code>，则默认从第0条显示。
<code>limit</code>经常和<code>order by</code>一起使用，用于分页显示。</p>
<h3 id="运算"><a class="header" href="#运算">运算</a></h3>
<h4 id="算术运算"><a class="header" href="#算术运算">算术运算</a></h4>
<pre><code class="language-sql">SELECT 1*2*3 as a, 1+2+3 as b;
SELECT city, (temp_hi+temp_lo)/2 AS temp_avg, date FROM weather;
</code></pre>
<h4 id="字符串运算"><a class="header" href="#字符串运算">字符串运算</a></h4>
<h5 id="大小写转换"><a class="header" href="#大小写转换">大小写转换</a></h5>
<pre><code class="language-sql">SELECT UPPER(Name) FROM Customers where UPPER(Name)='GARY';  -- LOWER
</code></pre>
<h4 id="json函数和运算符"><a class="header" href="#json函数和运算符">JSON函数和运算符</a></h4>
<blockquote>
<p><em>The main difference of json and jsonb data type is json will store the data into the plain text format while jsonb data type will store the data in binary format.</em></p>
</blockquote>
<h5 id="postgresql"><a class="header" href="#postgresql">PostgreSQL</a></h5>
<pre><code class="language-sql">SELECT json_field::json-&gt;0     as f FROM table;  # 获取JSON数组的元素
SELECT json_field::json-&gt;'key' as f FROM table;  # 获取JSON对象的值
SELECT json_field::json#&gt;'{key_idx,subkey_idx,...}' as f FROM table;  # 查询嵌套对象的元素
</code></pre>
<p>另外，运算符<code>-&gt;&gt;,#&gt;&gt;</code>将返回值转换为文本类型。</p>
<p><code>jsonb</code>类型支持比较运算符而<code>json</code>类型不支持，此外<code>jsonb</code>还支持以下特殊比较运算。</p>
<pre><code class="language-sql">json_a::jsonb @&gt; json_b::jsonb  # A是否包含B，&quot;&lt;@&quot; 反之
json_a::jsonb ? 'key'           # A的顶层键名/元素是否包含'key'
json_a::jsonb ?| array['key1', 'key2'] # 是否包含任意键名/元素，&quot;?&amp;&quot;包含所有键名/元素
</code></pre>
<p><a href="https://www.postgresql.org/docs/9.5/functions-json.html">JSON处理函数</a>。</p>
<h3 id="连接"><a class="header" href="#连接">连接</a></h3>
<p>当需要同时显示多个表中的字段时，就可以使用连接来实现。
连接可分为内连接和外连接。它们之间最主要的区别在于内连接只选出表中互相匹配的记录，而外连接会选出其他不匹配的记录。</p>
<h4 id="内连接"><a class="header" href="#内连接">内连接</a></h4>
<pre><code class="language-mysql">SELECT * | T1.cm [AS A1],T2.cn [AS A2][,...]
	FROM table_1 [AS] T1,table_2 [AS] T2
	WHERE T1.cx=T2.cy;
SELECT * FROM weather 
  [INNER] JOIN cities 
  ON (weather.city = cities.name);
</code></pre>
<p>当两个表存在相同列名时，需要使用表名（或别名）来区分引用同名列。</p>
<blockquote>
<p>在使用内连接时，必须注意<code>WHERE</code>语句的条件一定要是两个表的匹配条件，如果该条件是错误的（不匹配），则会产生笛卡尔连接，导致产生巨大的查询结果。</p>
</blockquote>
<h4 id="外连接"><a class="header" href="#外连接">外连接</a></h4>
<p>外连接又分为：</p>
<ul>
<li>全连接：包含所有</li>
<li>左连接：包含所有左边表中的记录，右表没有的记录填充<code>NULL</code>；</li>
<li>右连接：包含右边表中的所有记录，左表没有的记录填充<code>NULL</code>；</li>
</ul>
<p>外连接语法：</p>
<pre><code class="language-mysql">SELECT * FROM table_1 [[AS] T1]
    [LEFT|RIGHT|FULL] OUTER JOIN table_2 [[AS] T2]
    ON (T1.cx=T2.cy);
</code></pre>
<p>交换<code>FROM</code>后表的顺序，则左连接和右连接可以相互转换。</p>
<h3 id="子查询"><a class="header" href="#子查询">子查询</a></h3>
<p>查询语句中引用的数据，例如表或查询条件的值，可以是其他查询的返回值。</p>
<h5 id="查询表引用子查询结果"><a class="header" href="#查询表引用子查询结果">查询表引用子查询结果</a></h5>
<pre><code class="language-sql">SELECT * FROM ( SELECT sql_func(col) AS F FROM table) AS T where F = 'some_value'; 
</code></pre>
<h5 id="查询条件引用子查询结果"><a class="header" href="#查询条件引用子查询结果">查询条件引用子查询结果</a></h5>
<pre><code class="language-sql">SELECT * FROM table_name WHERE field_n OPERATOR (sub_select)
SELECT city FROM weather WHERE temp_lo = (SELECT max(temp_lo) FROM weather)；
</code></pre>
<h3 id="视图"><a class="header" href="#视图">视图</a></h3>
<p>将查询语句保存为视图。相比于子查询，方便后续重复引用。</p>
<pre><code class="language-sql">CREATE VIEW myview AS
    SELECT col_names FROM weather, cities WHERE city = name;
SELECT * from myview;
</code></pre>
<h2 id="聚合与分组"><a class="header" href="#聚合与分组">聚合与分组</a></h2>
<pre><code class="language-sql">SELECT [field,...] agg_func(field_i)	FROM table_name
	[GROUP BY field1,field2,...,fieldn [WITH ROLLUP]]
	[HAVING where_condition]
</code></pre>
<p><code>agg_func</code>：表示聚合函数，即对表的某一列进行的统计运算。常用的有<code>sum</code>、<code>count</code>（计数）、<code>max</code>（最大值）、<code>min</code>（最小值）。
<code>GROUP BY</code>：对查询的表首先根据字段进行分组 ，然后对每个子类进行运算统计（聚合）。<code>WITH ROLLUP</code>（汇总）：表示将分组统计结果作为一个整体，再次进行聚合运算，并将结果附加到分组计算结果之后。
<code>HAVING</code>：类似于<code>WHERE</code>，只是<code>HAVING</code>是在聚合之后对结果进行过滤，而<code>WHERE</code>是在聚合之前对原表进行过滤。</p>
<h3 id="window-functions"><a class="header" href="#window-functions">Window Functions</a></h3>
<p>进行分组并调用聚合函数，但聚合结果将关联到对应组的所有行，而非聚合为单条记录。</p>
<pre><code class="language-mysql">SELECT depname, salary, avg(salary) OVER (PARTITION BY depname) 
  FROM empsalary;
</code></pre>
<h2 id="事务transactions"><a class="header" href="#事务transactions">事务（Transactions）</a></h2>
<p>将多个操作步骤组合到一起形成原子操作，保证该组操作仅处于完全完成或未执行的状态。</p>
<blockquote>
<p><em>A transactional database guarantees that all the updates made by a transaction are logged in permanent storage (i.e., on disk) before the transaction is reported complete.</em></p>
</blockquote>
<pre><code class="language-mysql">BEGIN;
-- SQL statements
ROLLBACK; -- cancel the transaction
COMMIT; -- complete the transaction
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../数据库/SQL DDL.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../数据库/SQL数据类型.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../数据库/SQL DDL.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../数据库/SQL数据类型.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../theme/pagetoc.js"></script>
        <script type="text/javascript" src="../theme/MathJax.js"></script>
    </body>
</html>