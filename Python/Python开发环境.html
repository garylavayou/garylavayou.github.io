<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>开发环境 - Learning Programming Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The example book covers examples.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/pagetoc.css">
        <!-- MathJax -->
        <!-- <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        <script async type="text/javascript" src="theme/MathJax.js"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../prefix.html">Prefix</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">程序设计语言</li><li class="chapter-item expanded "><a href="../Python/Python编程基础.html">Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Python/Python编程基础.html">编程基础</a></li><li class="chapter-item expanded "><a href="../Python/Python开发环境.html" class="active">开发环境</a></li><li class="chapter-item expanded "><a href="../Python/Python数据类型.html">数据类型</a></li><li class="chapter-item expanded "><a href="../Python/Python输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../Python/Python编程应用.html">编程应用</a></li><li class="chapter-item expanded "><a href="../Python/Python数值计算.html">数值计算</a></li><li class="chapter-item expanded "><a href="../Python/Python系统编程.html">系统编程</a></li><li class="chapter-item expanded "><a href="../Python/Python高级编程.html">高级编程</a></li></ol></li><li class="chapter-item expanded "><a href="../Java/JAVA编程基础.html">Java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Java/JAVA编程基础.html">编程基础</a></li><li class="chapter-item expanded "><a href="../Java/Java开发环境.html">开发环境</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Java/Maven POM.html">Maven 配置</a></li></ol></li><li class="chapter-item expanded "><a href="../Java/JAVA数据类型.html">数据类型</a></li><li class="chapter-item expanded "><a href="../Java/JAVA输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../Java/JAVA系统编程.html">系统编程</a></li><li class="chapter-item expanded "><a href="../Java/Scala.html">Scala</a></li><li class="chapter-item expanded "><a href="../Java/ScalaFrameworks.html">Scala 框架</a></li></ol></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp编程基础.html">C#/.NET</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp编程基础.html">编程基础</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp数据容器.html">数据容器</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/CSharp数值计算.html">数值计算</a></li><li class="chapter-item expanded "><a href="../CSharp.NET/dotnet开发.html">.NET 开发</a></li></ol></li><li class="chapter-item expanded "><a href="../CC++/Modern C++.html">C and C++</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../CC++/Modern C++.html">Modern C++</a></li><li class="chapter-item expanded "><a href="../CC++/C++开发环境.html">开发环境</a></li><li class="chapter-item expanded "><a href="../CC++/C++容器.html">数据容器</a></li><li class="chapter-item expanded "><a href="../CC++/输入输出.html">输入输出</a></li><li class="chapter-item expanded "><a href="../CC++/标准函数库.html">标准库</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../CC++/数学函数.html">数学函数</a></li></ol></li></ol></li><li class="chapter-item expanded "><div>Web开发</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../JavaScript/JavaScript.html">JavaScript</a></li><li class="chapter-item expanded "><a href="../JavaScript/TypeScript.html">TypeScript</a></li><li class="chapter-item expanded "><a href="../JavaScript/JS开发环境.html">开发环境</a></li></ol></li><li class="chapter-item expanded "><div>开发工具</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../开发环境/git.html">Git</a></li><li class="chapter-item expanded "><a href="../笔记/正则表达式.html">正则表达式</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">操作系统</li><li class="chapter-item expanded "><a href="../Linux/Linux配置和管理.html">Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Linux/Linux配置和管理.html">配置管理</a></li><li class="chapter-item expanded "><a href="../Linux/Linux-Shell.html">Shell Script</a></li><li class="chapter-item expanded "><a href="../Linux/Linux发行版.html">Linux 发行版</a></li><li class="chapter-item expanded "><a href="../Linux/操作系统原理.html">操作系统原理</a></li></ol></li><li class="chapter-item expanded "><a href="../Windows/Windows配置管理.html">Windows</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Windows/Windows配置管理.html">配置管理</a></li><li class="chapter-item expanded "><a href="../Windows/Windows Shell.html">Shell</a></li><li class="chapter-item expanded "><a href="../Windows/Windows Applications.html">应用软件</a></li></ol></li><li class="chapter-item expanded "><div>应用软件</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../应用软件/程序开发软件.html">程序开发</a></li><li class="chapter-item expanded "><a href="../应用软件/服务器管理软件.html">服务器管理</a></li><li class="chapter-item expanded "><a href="../应用软件/网络访问软件.html">网络访问</a></li><li class="chapter-item expanded "><a href="../应用软件/网络服务软件.html">网络服务</a></li><li class="chapter-item expanded "><a href="../应用软件/文档生成软件.html">文档生成</a></li><li class="chapter-item expanded "><a href="../应用软件/文件处理软件.html">文件处理</a></li><li class="chapter-item expanded "><a href="../应用软件/协作办公软件.html">协作办公</a></li><li class="chapter-item expanded "><a href="../应用软件/知识管理软件.html">知识管理</a></li><li class="chapter-item expanded "><a href="../应用软件/多媒体编辑软件.html">多媒体编辑</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">机器学习</li><li class="chapter-item expanded "><a href="../机器学习/机器学习实践.html">机器学习实践</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../机器学习/ScikitLearn.html">scikit-learn</a></li><li class="chapter-item expanded "><a href="../机器学习/TensorFlow.html">TensorFlow</a></li><li class="chapter-item expanded "><a href="../机器学习/Pytorch.html">Pytorch</a></li><li class="chapter-item expanded "><a href="../机器学习/图神经网络.html">图神经网络</a></li></ol></li><li class="chapter-item expanded "><a href="../机器学习/机器学习原理与算法.html">原理与算法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../机器学习/统计学习算法.html">统计学习算法</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">数据库</li><li class="chapter-item expanded "><a href="../数据库/SQL语法.html">SQL</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../数据库/SQL DDL.html">SQL DDL</a></li><li class="chapter-item expanded "><a href="../数据库/SQL DML.html">SQL DML</a></li><li class="chapter-item expanded "><a href="../数据库/SQL数据类型.html">数据类型</a></li></ol></li><li class="chapter-item expanded "><a href="../数据库/MySQL.html">MySQL</a></li><li class="chapter-item expanded "><a href="../数据库/PostgreSQL.html">PostgreSQL</a></li><li class="chapter-item expanded "><a href="../数据库/HiveSQL.html">Hive SQL</a></li><li class="chapter-item expanded "><a href="../数据库/Elasticsearch.html">Elasticsearch</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../数据库/Elastic Datasource.html">数据源</a></li></ol></li><li class="chapter-item expanded "><a href="../数据库/Mongodb.html">Mongodb</a></li><li class="chapter-item expanded "><a href="../数据库/GraphDatabase.html">图数据库</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">服务和大数据平台</li><li class="chapter-item expanded "><a href="../服务器/分布式大数据处理.html">分布式大数据处理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../服务器/CDH6大数据集群离线安装.html">CDH6 安装教程</a></li><li class="chapter-item expanded "><a href="../服务器/Spark Python API.html">Pyspark</a></li><li class="chapter-item expanded "><a href="../服务器/流数据处理.html">流数据处理</a></li></ol></li><li class="chapter-item expanded "><a href="../服务器/容器编排.html">容器编排</a></li><li class="chapter-item expanded "><a href="../服务器/虚拟化.html">虚拟化</a></li><li class="chapter-item expanded "><div>任务编排</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../服务器/Airflow.html">Airflow</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">其他</li><li class="chapter-item expanded "><div>数据标记语言</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../数据交换语言/JSON and YAML.html">JSON and YAML</a></li><li class="chapter-item expanded "><a href="../数据交换语言/XML.html">XML</a></li><li class="chapter-item expanded "><a href="../数据交换语言/HTML.html">HTML</a></li></ol></li><li class="chapter-item expanded "><div>网络协议</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Protocols/http.html">HTTP</a></li><li class="chapter-item expanded "><a href="../Protocols/DNS.html">DNS</a></li><li class="chapter-item expanded "><a href="../Protocols/端口分配.html">端口分配</a></li><li class="chapter-item expanded "><a href="../Protocols/IP protocol numbers.html">IP 承载协议</a></li><li class="chapter-item expanded "><a href="../Protocols/RPC.html">RPC</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Learning Programming Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="python开发环境配置"><a class="header" href="#python开发环境配置">Python开发环境配置</a></h1>
<h2 id="python环境"><a class="header" href="#python环境">Python环境</a></h2>
<h3 id="系统集成python环境"><a class="header" href="#系统集成python环境">系统集成Python环境</a></h3>
<p>以Ubuntu为例，系统自带Python 3，用于支持相关系统组件工作。如果某些软件的运行需要依赖Python软件包而系统并未预装，则可以使用软件源管理工具（<code>apt</code>）安装。</p>
<blockquote>
<p>使用相关python命令时需要注意：系统自带的<code>python3/pip3</code>并没有创建符号链接<code>python/pip</code>，以便可以同时安装Python 2。</p>
</blockquote>
<pre><code class="language-shell">sudo apt install {python-package_name|python3-package_name}
sudo apt install python-is-python3  # 设置默认版本为Python3
</code></pre>
<p>如果软件源中找不到所需软件包，则可以通过<code>pip</code>工具从Python的软件仓库中下载软件包。系统的Python发行版默认未安装安装<code>pip</code>，需手动安装：</p>
<pre><code class="language-shell">sudo apt install {python-pip|python3-pip} # Python package installer
</code></pre>
<p><code>python3-dev</code>：Python软件开发依赖环境（<em>header files and a static library for Python (default).</em>），在Fedora/CentOS中命名为<code>python3-devel</code>。</p>
<h5 id="查找软件包"><a class="header" href="#查找软件包">查找软件包</a></h5>
<pre><code class="language-shell">pip list	          # list installed packages
pip show &lt;package&gt;  # show information about installed packages
</code></pre>
<p>使用<code>pip</code>(<code>pip3</code>)安装和移除软件包：</p>
<pre><code class="language-shell">pip install &lt;pkgs&gt; \
    --user                                 # 仅为当前用户安装，默认为系统范围安装
    -r requirements.txt \                  # 指定安装包声明文件
    -i https://pypi.doubanio.com/simple/ \ # 强制使用镜像站点
    --trusted-host 172.28.76.237           # 如果使用自建的代理站点，添加此选项
pip uninstall -r &lt;requirements_file&gt;
pip cache remove &lt;pattern&gt;|purge
</code></pre>
<blockquote>
<p>使用<code>sudo</code>在系统范围安装。</p>
<p>Ubuntu等Linux发行版已经内置许多python模块，应该优先使用软件源管理工具而非<code>pip</code>进行系统范围的Python软件包更新，否则可能导致系统功能出错。仅使用<code>pip</code>更新手动安装的软件包。如果不小心使用<code>pip</code>更新了<code>pip</code>，可以卸载更新后的版本并使用软件源管理工具重装。</p>
<pre><code class="language-shell">sudo python3 -m pip uninstall pip
sudo apt install python3-pip --reinstall
</code></pre>
<p>如果需要创建开发环境，使用虚拟Python环境（<a href="#Virtualenv">Virtualenv</a>）</p>
</blockquote>
<h5 id="软件更新"><a class="header" href="#软件更新">软件更新</a></h5>
<pre><code class="language-shell">pip list --outdated
pip install --upgrade package_name # 安装并更新依赖包（默认不更新）
pip-review  # pip install pip-review
# pip install pipupgrade
</code></pre>
<blockquote>
<ol>
<li>
<p><a href="https://github.com/achillesrasquinha/pipupgrade">achillesrasquinha/pipupgrade: 🗽 Like yarn outdated/upgrade, but for pip. Upgrade all your pip packages and automate your Python Dependency Management. (github.com)</a></p>
</li>
<li>
<p><a href="https://github.com/jgonggrijp/pip-review">jgonggrijp/pip-review: A tool to keep track of your Python package updates. (github.com)</a></p>
</li>
</ol>
</blockquote>
<p>使用较近的PyPi镜像站点可以加速软件包下载。</p>
<h5 id="离线安装"><a class="header" href="#离线安装">离线安装</a></h5>
<p>下载（不安装）安装包，默认同时下载依赖包。</p>
<pre><code class="language-shell">pip download [--python-version 3.7.4] package_name[==version]
</code></pre>
<blockquote>
<p><code>-d,--dest &lt;dir&gt;</code>: 下载目标文件夹（默认为当前工作目录）。</p>
<p>指定<code>--python-version</code>时，必须同时指定<code>--no-deps</code>或<code>--only-binary=:all:</code>。</p>
</blockquote>
<p>安装离线包</p>
<pre><code class="language-shell">pip install --no-index --find-links=/local_path package_name
</code></pre>
<blockquote>
<p><code>--find-links</code>：如果指定本地路径或<code>file://url</code>，则优先在本地目录中寻找安装文件。</p>
<p><code>--no-index</code>：不使用在线仓库搜索依赖包；</p>
</blockquote>
<h3 id="anacondaminiconda"><a class="header" href="#anacondaminiconda">Anaconda/Miniconda</a></h3>
<p>Anaconda发行版打包了Python常用的软件包，可以从<a href="https://repo.anaconda.com/archive/Anaconda3-2019.07-Linux-x86_64.sh">官网</a>或<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-5.3.1-Linux-x86_64.sh">镜像</a>站点下载安装包。<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh">Miniconda</a>是精简发行版，仅包含python语言环境和conda工具，其他软件包均需要在线下载。</p>
<blockquote>
<p>Anaconda/Miniconda可以配置自定义的python环境屏蔽系统的Python，可以任意修改该环境而不会对系统产生影响。</p>
<p>在<code>Linux aarch64</code>平台上，<a href="https://docs.conda.io/en/master/miniconda.html">官方提供的安装包</a>可能安装失败，可尝试使用<a href="https://github.com/conda-forge/miniforge">conda-forge/miniforge: A conda-forge distribution. (github.com)</a>。</p>
<ul>
<li><em><code>version 'GLIBC_2.25' not found</code></em></li>
</ul>
</blockquote>
<blockquote>
<p>Anaconda基础环境的Python版本参考发行注记：https://docs.anaconda.com/anaconda/reference/release-notes/。</p>
</blockquote>
<h4 id="安装conda运行环境"><a class="header" href="#安装conda运行环境">安装conda运行环境</a></h4>
<pre><code class="language-shell">bash conda_installer.sh -b -f -p $INSTALL_PATH  # 静默安装并指定安装路径
# -u更新已有安装；
</code></pre>
<p>静默安装模式不会执行初始化修改路径配置。如果安装期间未执行初始化，则Shell无法直接运行<code>conda</code>（不在路径中）。</p>
<pre><code class="language-python">eval &quot;$($CONDAROOT/bin/conda shell.bash hook)&quot;   # 激活默认环境
conda init   # [yes]
</code></pre>
<p>也可以<a href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/rpm-debian.html">使用包管理器安装</a>，方便<a href="#%E5%8D%B8%E8%BD%BDAnaconda/Miniconda">卸载</a>。</p>
<h5 id="重新安装anacondaminiconda"><a class="header" href="#重新安装anacondaminiconda">重新安装Anaconda/Miniconda</a></h5>
<p>如果基础环境因为更新问题损坏（网络、杀毒软件拦截）需要重装，而不希望重装已配置的<a href="#Conda%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83">虚拟环境</a>，可以将虚拟环境目录<code>envs</code>备份，在重装基础环境后还原。</p>
<h5 id="卸载anacondaminiconda"><a class="header" href="#卸载anacondaminiconda">卸载Anaconda/Miniconda</a></h5>
<pre><code class="language-shell">conda install anaconda-clean
anaconda-clean --yes  # backup all files/directories in ~/.anaconda_backup 
rm -rf $CONDA_HOME
</code></pre>
<p>最后清理<code>~/.bashrc</code>中的<code>conda</code>初始化代码。</p>
<h4 id="conda配置"><a class="header" href="#conda配置">conda配置</a></h4>
<p>使用命令行修改配置项，</p>
<pre><code class="language-shell">conda config --{system|env} SUB_COMMAND
</code></pre>
<p><code>conda</code>配置文件包括三类：</p>
<ul>
<li><code>--system</code>：修改系统配置位于<code>$CONDA_HOME/.condarc</code>；</li>
<li><code>--env</code>：修改当前激活环境的配置，位于<code>$CONDA_HOME/envs/$ENV/.condarc</code>；</li>
<li>如果未指定上述选项，则修改当前用户的配置，位于<code>$HOME/.condarc</code>。</li>
</ul>
<p>修改配置：</p>
<pre><code class="language-shell">conda config --append KEY VALUE      # 为配置项KEY追加一个值
             --prepend/add KEY VALUE # 为配置项KEY前端插入一个值
             --remove KEY VALUE      # 从配置项KEY的值列表中删除匹配的VALUE
             --set KEY VALUE         # 更新配置项的值
             --remove-key KEY        # 移除配置项
</code></pre>
<h5 id="列出当前的conda配置"><a class="header" href="#列出当前的conda配置">列出当前的conda配置</a></h5>
<pre><code class="language-shell">conda config --show [CONFIG]
conda config --describe [CONFIG]  # 显示配置项的说明
</code></pre>
<h5 id="自动激活基础conda环境"><a class="header" href="#自动激活基础conda环境">自动激活基础conda环境</a></h5>
<p>是否在shell启动时启动Conda环境：</p>
<pre><code class="language-shell">conda config --set auto_activate_base false  # =&gt; auto_activate_base: false
</code></pre>
<h4 id="使用conda进行包管理"><a class="header" href="#使用conda进行包管理">使用<code>conda</code>进行包管理</a></h4>
<pre><code class="language-shell">conda info	# infomation of conda installation (.condarc)
conda list [package_name] [-n envname]
conda search name --info
conda {update|upgrade} {--all | package_names}
conda [&lt;cmd&gt;] --help
</code></pre>
<p>Anaconda/Miniconda使用<code>conda</code>作为软件包管理工具。更新<code>conda</code>工具：</p>
<pre><code class="language-shell">conda update -n base -c defaults conda
</code></pre>
<blockquote>
<p>Anaconda发布的Python版本中，机器学习库<code>sklearn</code>打包在<code>scikit-learn</code>中。</p>
</blockquote>
<p>固定包的版本：在<code>conda-meta</code>目录中创建一个名为<code>pinned</code>的文件并加入不希望更新的包名以及版本信息（可以使用<code>#</code>注释行）。</p>
<pre><code class="language-shell">numpy 1.7.*     # stay on the 1.7 series
scipy==0.14.2  # fix to 0.14.2
</code></pre>
<pre><code class="language-shell">conda update numpy --no-pin   # 忽略pinned文件中的声明
</code></pre>
<blockquote>
<p>每次执行更新时，conda会检查<code>pinned</code>文件，因此使用<code>--no-pin</code>升级的包会恢复到<code>pinned</code>文件中声明的版本。</p>
</blockquote>
<h5 id="清理缓存"><a class="header" href="#清理缓存">清理缓存</a></h5>
<p>当软件包升级后，旧版本的软件包可能不再有用，因此可以从本地缓存删除。</p>
<pre><code class="language-shell">conda clean \ # Remove unused packages and caches.
      --all \ # index cache, lock files, unused packages and tarballs
      -i,--index-cache  \ # 清除索引缓存，保证用的是镜像站提供的索引。
      -p,--packages     \ # Remove unused packages
      -t,--tarballs     \ # remove cached package tarballs
      -l,--logfiles
      -d,--dry-run
</code></pre>
<h5 id="安装软件包"><a class="header" href="#安装软件包">安装软件包</a></h5>
<pre><code class="language-shell">conda {remove|uninstall} package_names
conda install -c conda-forge vaex=4.0.0 # --dry-run
conda install package_names \
	--file requirements.txt \ # 安装文件给定的包
	--freeze-installed \      # 避免已安装包升级
	-n| --name ENVNAME \      # 目标环境名（未指定则为当前环境，默认为base）
	-p,--prefix ENVPATH \     # 目标环境的目录
</code></pre>
<blockquote>
<p><code>conda</code>尝试安装最新的包，为此将升级其依赖的安装包。使用<code>--freeze-installed</code>避免已安装包自动升级。</p>
</blockquote>
<p><strong>指定仓库名</strong>：<code>-c,--channel</code>指定安装软件包优先使用的仓库；如果未指定该参数或指定仓库不包含相应的软件包，<code>conda</code>会检查<code>.condarc</code>中设定的<a href="#conda%E8%BD%AF%E4%BB%B6%E6%BA%90"><code>channels</code>中包含的其他仓库</a>。</p>
<p>软件包声明文件格式：</p>
<pre><code class="language-shell">channel::package_name=version=build_string # 使用指定使用*进行模糊匹配
</code></pre>
<blockquote>
<p>声明<code>channel</code>代替当前的默认通道；</p>
</blockquote>
<p>常用声明格式：</p>
<pre><code class="language-shell">pytorch             # 安装最新的兼容版本
cudatoolkit&gt;=11.3   # 限制最低版本 （命令行使用时需要使用&quot;&quot;对&gt;&lt;转义，避免解释为重定向）
cudatoolkit=11.3.*  # 仅接受小版本更新（如果后续无build声明可省略.*）
cudatoolkit=11.3.1  # 安装固定版本
</code></pre>
<h6 id="安装离线包"><a class="header" href="#安装离线包">安装离线包</a></h6>
<pre><code class="language-shell">conda install --use-local   /path/XXX.tar.bz
</code></pre>
<p>在Anaconda/Miniconda的Python环境中也可以使用<code>pip</code>进行软件包管理。</p>
<p><em>使用conda下载离线包</em>：<code>conda</code>只能将软件包加载到本地仓库（缓存）中，而无法下载到指定文件夹。</p>
<blockquote>
<p><code>conda</code>本地仓库中的包无法用于<code>pip</code>安装。</p>
</blockquote>
<h6 id="安装conda软件源中没有的包"><a class="header" href="#安装conda软件源中没有的包">安装Conda软件源中没有的包</a></h6>
<pre><code class="language-shell">pip install --upgrade-strategy &quot;only-if-needed&quot; packname
</code></pre>
<blockquote>
<ul>
<li>在使用conda安装尽可能多的包后，再使用<code>pip</code>安装额外包；</li>
<li>在单独虚拟环境中使用<code>pip</code>(避免使用root环境)；使用<code>pip</code>后，Conda无法识别相应的更改；</li>
<li>如果后续还需要使用Conda进行更新或安装而外包，则使用基本环境再重新创建一个环境后再使用<code>pip</code>；</li>
<li>使用<code>-r, --requirements</code>指定需要使用<code>pip</code>安装的包。</li>
</ul>
</blockquote>
<p>https://www.anaconda.com/using-pip-in-a-conda-environment/</p>
<h3 id="虚拟python环境"><a class="header" href="#虚拟python环境">虚拟Python环境</a></h3>
<h4 id="virtualenv"><a class="header" href="#virtualenv">virtualenv</a></h4>
<p>在指定目录<code>ENV_DIR</code>创建一个虚拟Python环境。</p>
<pre><code class="language-shell">python3 -m venv ENV_DIR
</code></pre>
<blockquote>
<p>创建虚拟环境，默认包含Python解释器（与系统中Python解释版本相同）、标准库等。可以使用<code>pip</code>为虚拟环境安装额外的内容。</p>
<p>在Debian/Ubuntu系统中需要首先安装</p>
<pre><code class="language-shell">apt-get install python3-venv
</code></pre>
</blockquote>
<p>Windows激活虚拟环境：</p>
<pre><code class="language-shell">.\myenv\Scripts\activate.bat  # windows cmd
.\myenv\Scripts\Activate.ps1  # windows powershell
</code></pre>
<p>Linux激活虚拟环境：</p>
<pre><code class="language-shell">source myenv/bin/activate   # on linux
which python  # 查看python路径
</code></pre>
<h5 id="pipenv"><a class="header" href="#pipenv">pipenv</a></h5>
<p><a href="https://realpython.com/pipenv-guide/">Pipenv: A Guide to the New Python Packaging Tool – Real Python</a></p>
<p>consolidate the <code>pip</code> &amp; <code>virtualenv</code> into a single interface. </p>
<h4 id="conda虚拟环境"><a class="header" href="#conda虚拟环境">Conda虚拟环境</a></h4>
<blockquote>
<p><em>It makes your project more self-contained as everything, including the required software, is contained in a single project directory.</em></p>
</blockquote>
<p>基于<code>conda</code>创建的虚拟环境并安装指定的软件包（和安装一样使用<code>--file requirements.txt</code>指定安装包）。Conda默认将虚拟环境置于<code>envs</code>目录下，并通过<code>--names/-n</code>选项指定要使用的环境名。使用<code>--prefix</code>可将虚拟环境置于任何路径下，但访问时也需要通过<code>--prefix</code>选项指定目录。</p>
<pre><code class="language-shell">conda create -n pydev37 python=3.7 &lt;pkgname=ver,...&gt; \ # python=3*
             --prefix ./envs ...          # 指定虚拟环境的安装目录
conda create --name myclone --clone myenv # 复制已有环境
conda env remove --name myenv             # &lt;=&gt; conda remove -n env_name --all 
conda env list                            # &lt;=&gt; conda info --envs
</code></pre>
<blockquote>
<p><code>*</code>：如果创建环境时未指定Python版本，可能导致依赖解析很慢。</p>
<p>支持创建Python 2.x环境。</p>
<p>虚拟环境中不会维护独立的软件包，而是由Conda维护一个统一的包目录（<code>pkgs</code>）。通过<code>conda-meta</code>目录中的信息，可以定位到其引用的包路径，包的档案文件路径以及软件源路径。</p>
<p>复制环境可直接将虚拟环境目录复制到<code>envs</code>目录下（如果虚拟环境路径发生变化，需要使用<code>conda-pack</code>进行<a href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2">打包并在目标系统中解压并修复路径</a>）</p>
</blockquote>
<p>虚拟环境配置默认继承系统和用户配置，可以<a href="#conda%E9%85%8D%E7%BD%AE">为虚拟环境添加设置覆盖默认配置</a>。</p>
<p>查看conda环境更改历史：</p>
<pre><code class="language-shell">conda list --revision[s]
conda install --revision=REVNUM   # 恢复历史版本
</code></pre>
<p>虚拟环境信息文件：</p>
<pre><code class="language-shell">conda env export [--from-history] &gt; environment.yml
</code></pre>
<p>更新环境</p>
<pre><code class="language-shell">conda env update --prefix | --name --file environment.yml --prune
</code></pre>
<p>复制环境</p>
<pre><code class="language-shell">conda env create -f environment.yml   #从配置文件创建虚拟环境
#=========================================
conda list --explicit &gt; spec-file.txt
conda create --name myenv --file spec-file.txt
conda install --name myenv --file spec-file.txt
</code></pre>
<h5 id="使用conda虚拟环境"><a class="header" href="#使用conda虚拟环境">使用conda虚拟环境</a></h5>
<pre><code class="language-shell">conda activate env_name
conda deactivate
conda config --set env_prompt '({name})'
</code></pre>
<blockquote>
<p>在脚本中尝试激活命令时会出现conda环境未初始化的错误，可在脚本中执行<code>source ~/.bashrc</code>或将<code>~/.bashrc</code>中的conda初始化代码复制到用户脚本中。</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/55507519/python-activate-conda-env-through-shell-script">Python - Activate conda env through shell script - Stack Overflow</a></p>
<p><a href="https://github.com/conda/conda/issues/7980">Can't execute <code>conda activate</code> from bash script · Issue #7980 · conda/conda (github.com)</a></p>
<h4 id="虚拟python环境损坏"><a class="header" href="#虚拟python环境损坏">虚拟Python环境损坏</a></h4>
<p><code>AttributeError: module 'brotli' has no attribute 'error'</code></p>
<p>解决方法：使用<code>conda remove</code>删除损坏的环境，并删除本地目录；</p>
<h5 id="pipeenv"><a class="header" href="#pipeenv">Pipeenv</a></h5>
<h4 id="虚拟环境打包部署"><a class="header" href="#虚拟环境打包部署">虚拟环境打包部署</a></h4>
<p><code>conda-pack</code>可以将虚拟Python环境打包并部署到其他位置（操作系统相同）。可创建一个包含<code>conda-pack</code>的虚拟环境专门用于打包。</p>
<pre><code class="language-shell">conda create -n pack -c conda-forge &quot;conda-pack&gt;=0.7&quot;  # pip install conda-pack=0.7
</code></pre>
<blockquote>
<p><em><code>CondaPackError: Files managed by conda were found to have been deleted/overwritten...</code></em>：</p>
<ol>
<li>Python升级到3.10后，其模块库目录下会创建一个<code>python3.1-&gt;python3.10</code>的符号链接；这会<a href="https://stackoverflow.com/questions/69992742/conda-pack-condapackerror-files-managed-by-conda-were">导致旧版本的<code>conda-pack</code>无法正常工作</a>，需要使用<code>conda-pack&gt;=0.7</code>。</li>
<li>如果虚拟环境中使用<code>pip</code>安装了额外包，也可能导致上述错误。因此可将pip的安装包单独下载，再在目标环境中执行离线安装。</li>
</ol>
</blockquote>
<p>然后将目标环境打包环境为一个压缩档案文件（<code>tar.gz</code>）：</p>
<pre><code class="language-shell">conda-pack --name my_env \
           --output out_name.tar.gz \ # 指定环境名
           -d target_env_path \   #目标主机上虚拟环境的路径
           --force
conda-pack -p /explicit/path/to/my_env  # 指定环境路径
</code></pre>
<p>在目标位置解压文件，并激活虚拟环境（要求目标环境安装<code>conda</code>）：</p>
<pre><code class="language-shell">tar -xzf my_env.tar.gz -C conda_path/envs/my_env
source my_env/bin/activate # 激活环境 add `my_env/bin` to your path
conda-unpack               # 修复库的路径（可在未激活环境情况下运行，指定路径） 
</code></pre>
<p><code>conda-unpack</code>是<code>conda-pack</code>打包到虚拟环境中的程序（<code>envname/bin</code>目录下），在解压后修复某些库的路径。==如果打包时指定<code>-d</code>选项，则不再打包<code>unpack</code>程序==。</p>
<p><a href="https://conda.github.io/conda-pack/">Conda-Pack — conda-pack 0.6.0 documentation</a>.</p>
<h3 id="arm64版本python"><a class="header" href="#arm64版本python">Arm64版本Python</a></h3>
<p>支持aarch64 (arm64)的Conda环境：</p>
<ul>
<li><a href="https://github.com/conda-forge/miniforge">conda-forge/miniforge: A conda-forge distribution. (github.com)</a></li>
<li>https://repo.anaconda.com/archive/Anaconda3-2021.04-Linux-aarch64.shell</li>
</ul>
<blockquote>
<p>需要使用conda-forge作为默认源（miniforge的默认设置），且不能使用国内镜像源（同步不完整）。</p>
</blockquote>
<h2 id="软件源配置"><a class="header" href="#软件源配置">软件源配置</a></h2>
<h3 id="pip软件源"><a class="header" href="#pip软件源">pip软件源</a></h3>
<p>配置软件源和下载设置：</p>
<pre><code class="language-shell">pip config set global.timeout 6000
pip config set global.index-url https://pypi.doubanio.com/simple/
pip config set install.use-mirrors true
pip config set install.mirrors https://pypi.doubanio.com/simple/
</code></pre>
<p>该配置文件位于<code>$HOME/.pip/pip.conf</code>（系统自带Python的配置文件位于<code>$HOME/.config/pip/pip.conf</code>）。也可以手动创建并编辑该文件（Windows下的配置文件位于<code>%HOMEPATH%\AppData\Roming\pip\pip.ini</code>），在文件中添加以下内容：</p>
<pre><code class="language-shell">[global]
timeout = 6000
index-url = https://pypi.doubanio.com/simple
[install]
use-mirrors = true
mirrors = https://pypi.doubanio.com/simple
</code></pre>
<p>常用软件源包括：</p>
<ul>
<li><code>https://pypi.doubanio.com</code>：豆瓣；</li>
<li><code>http://mirrors.aliyun.com/pypi</code>：阿里；</li>
<li><code>http://pypi.mirrors.ustc.edu.cn</code>：中国科学技术大学；</li>
<li><code>https://pypi.tuna.tsinghua.edu.cn</code>：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">清华大学</a>；</li>
</ul>
<p>本地镜像可用<a href="../%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E8%BD%AF%E4%BB%B6.html#pypi%E4%BB%A3%E7%90%86">Nexus配置</a>。</p>
<h3 id="conda软件源"><a class="header" href="#conda软件源">conda软件源</a></h3>
<p>添加默认仓库<code>defaults</code>的地址：</p>
<pre><code class="language-shell">conda config --add default_channels \
    https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/  # add default channel URL
conda config --set show_channel_urls yes  # 显示下载内容的URL
</code></pre>
<p>添加自定义仓库名称和地址：</p>
<pre><code class="language-shell">conda config --{prepend|append} channels &lt;new_channel&gt;
conda config --set custom_channels.conda-forge \
    https://mirror.sjtu.edu.cn/anaconda/cloud/
</code></pre>
<p>直接编辑该文件：</p>
<pre><code class="language-yaml">channels:
  - conda-forge
  - defaults
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch:     https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
</code></pre>
<p>配置文件中<code>channels</code>可包含多个源，优先级从上到下递减。默认从高优先级的源选择同名软件包（<code>channel_priority=strict</code>）；反之优先选择高版本号的同名软件包。</p>
<pre><code class="language-shell">conda config --set channel_priority strict
</code></pre>
<p>通过<code>default_channels</code>配置<code>defaults</code>仓库的实际地址；通过<code>custom_channels</code>配置其他仓库对应的地址；如果未设定相应的地址信息，则默认连接到<a href="https://conda.anaconda.org/">Anaconda官方仓库</a>。</p>
<p>列出当前的仓库配置</p>
<pre><code class="language-shell">conda config --show channels
conda config --show-sources   # show all sources
conda config --validate       # 验证仓库源
</code></pre>
<h5 id="仓库镜像"><a class="header" href="#仓库镜像">仓库镜像</a></h5>
<ul>
<li><code>https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/</code>：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/">清华大学</a>，包含<code>pytorch</code>、<code>conda-forge</code>等多个仓库，其中<code>conda-forge</code>包含<code>linux-aarch64</code>架构的仓库，可用于ARM平台；</li>
<li><code>https://mirrors.bfsu.edu.cn/anaconda/cloud/</code>：<a href="https://mirrors.bfsu.edu.cn/help/anaconda/">北京外国语大学</a>（与清华大学镜像源一致）；</li>
<li><code>https://mirror.sjtu.edu.cn/anaconda/cloud/</code>：<a href="https://mirrors.sjtug.sjtu.edu.cn/docs/anaconda">上海交通大学</a>（不包含<code>conda-forge/linux-aarch64</code>）；</li>
<li><code>https://mirrors.aliyun.com/anaconda/cloud/</code>：<a href="https://developer.aliyun.com/mirror/anaconda">阿里云</a>（不包含<code>conda-forge/linux-aarch64</code>）。</li>
</ul>
<h5 id="使用nexus可创建镜像代理"><a class="header" href="#使用nexus可创建镜像代理">使用<a href="../%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E8%BD%AF%E4%BB%B6.html#conda%E4%BB%A3%E7%90%86">Nexus</a>可创建镜像代理</a></h5>
<blockquote>
<p>Nexus Conda代理不会获取<code>current_repodata.json</code>，因此使用<code>conda</code>时总是会回退使用<code>repodata.json</code>，导致解析速度变慢（直接使用镜像源则不会有此问题）。<code>mamba</code>总是使用<code>repodata.json</code>不会受此影响。</p>
</blockquote>
<p>多数镜像源仅包含最常用的仓库，如<code>conda-forge</code>、<code>pytorch</code>，而一些开源库在Anaconda官方仓库维护了独立的仓库（仅包含开源库相关包），因此要使用这些仓库需要使用Anaconda官方仓库作为代理源。</p>
<pre><code class="language-ini">Name=anaconda-cloud
Remote=https://conda.anaconda.org/
URL=http://192.168.178.52:8081/repository/anaconda-cloud
</code></pre>
<h4 id="软件包下载优化"><a class="header" href="#软件包下载优化">软件包下载优化</a></h4>
<h5 id="安装mambalibmamba加速依赖解析和下载"><a class="header" href="#安装mambalibmamba加速依赖解析和下载">安装mamba/libmamba加速依赖解析和下载</a></h5>
<blockquote>
<p><em><code>mamba</code> is a reimplementation of the conda package manager in C++.</em></p>
</blockquote>
<p><code>mamba</code>支持多线程并行下载仓库数据和包文件，使用<code>libsolv</code>以加速依赖解析（用于RPM包管理器）。</p>
<pre><code class="language-shell">conda install -n base -c conda-forge mamba
</code></pre>
<p>安装完成后，使用<code>mamba</code>代替<code>conda</code>进行包管理，其语法与<code>conda</code>一致。</p>
<blockquote>
<p>最新的<code>conda</code>版本（<code>22.9+</code>）提供<code>--experimental-solver libmamba</code>选项（需要安装<code>conda-libmamba-solver</code>包），使用<code>mamba</code>进行依赖解析，但仍采用<code>conda</code>下载包。</p>
</blockquote>
<p><code>mamba/libmamba</code>虽然加速解析和下载，但不使用本地缓存导致重复下载（<em>虽然检测到本地缓存包但似乎URL不匹配</em>）。如果是通过本地镜像仓库下载，则重复下载没有多大影响；防止，如果通过远程仓库下载，这重复下载比较浪费时间。</p>
<h5 id="配置http代理"><a class="header" href="#配置http代理">配置HTTP代理</a></h5>
<p><code>conda</code>会自动检测系统代理配置，但不支持<code>$no_proxy</code>例外项。如果<code>conda</code>使用的代理配置与系统配置不同，可在<code>.condarc</code>中指定（同样不支持例外项）。</p>
<pre><code class="language-yaml">proxy_servers:
  http: http://172.28.76.4:3128
  https: http://172.28.76.4:3128
</code></pre>
<blockquote>
<p><code>conda</code>/<code>mamba</code>使用<code>urllib3</code>，会读取环境变量<code>$http[s]_proxy</code>；Windows中优先检测环境变量<code>$env:HTTP[s]_PROXY</code>，其次检测<strong>网络设置</strong>中的<strong>代理设置</strong>，可通过代理设置的例外项排除不需要通过代理访问的镜像源地址，例如本地仓库代理。）</p>
</blockquote>
<h5 id="网络超时设置"><a class="header" href="#网络超时设置">网络超时设置</a></h5>
<p>当使用<code>nexus</code>镜像代理时，新内容会首先下载到代理服务器，然后再下载到本地。因此，代理服务器如果下载速度较慢会导致本地<code>conda</code>下载超时。这种情况，可将网络读取的超时限制调大。</p>
<pre><code class="language-yaml">remote_read_timeout_secs: 180.0  # 60.0 by default
</code></pre>
<blockquote>
<p><code>mamba</code>忽略该选项，<em>尝试设置<code>export MAMBA_NO_LOW_SPEED_LIMIT=1</code></em>。</p>
</blockquote>
<h2 id="开发环境"><a class="header" href="#开发环境">开发环境</a></h2>
<h3 id="标准库"><a class="header" href="#标准库">标准库</a></h3>
<ul>
<li>
<p>系统管理：<code>os, sys, shutil</code></p>
</li>
<li>
<p>日期时间：<code>datetime, time, calendar</code></p>
</li>
<li>
<p>高级数据结构：<code>collections, array, enum </code></p>
</li>
<li>
<p>输入输出控制：<code>io, fcntl, logging, getpass, warnings</code></p>
</li>
<li>
<p>数据处理：<code>re</code>, <code>struct</code></p>
</li>
<li>
<p>文件解析：<code>csv, configparser, json, xml, html</code></p>
<p>Python有三种方法解析XML，SAX，DOM，以及ElementTree。ElementTree就像一个轻量级的DOM，具有方便友好的API。代码可用性好，速度快，消耗内存少。</p>
<blockquote>
<p>**注：**因DOM需要将XML数据映射到内存中的树，一是比较慢，二是比较耗内存，而SAX流式读取XML文件，比较快，占用内存少，但需要用户实现回调函数（handler）。</p>
</blockquote>
</li>
<li>
<p>数据持久化：<code>pickle, marshal, sqlite3</code></p>
<p><code>sqlite</code>使用文件保存数据，因此无需运行任何服务。Python内置<code>sqlite3</code>提供sqlite数据库的操作。</p>
</li>
<li>
<p>数据库：<code>mysql-connector-python</code>, <code>psycopg2</code>（PostgreSQL）</p>
<p>DB-API 是一个规范. 它定义了一系列必须的对象和数据库存取方式, 以便为各种各样的底层数据库系统和多种多样的数据库接口程序提供一致的访问接口 。</p>
<p><a href="https://realpython.com/python-sql-libraries/">Introduction to Python SQL Libraries</a>.</p>
</li>
<li>
<p>网络通信：<code>socket,ipaddress</code>,  <code>xmlrpc</code>, <code>email,smtpd,smtplib,imaplib,poplib</code>,  <code>cgi</code>, <code>ftplib</code>, <code>uuid,base64,urllib.parse</code></p>
</li>
<li>
<p>HTTP：<code>http</code>, <code>urllib.request</code></p>
<blockquote>
<p><a href="https://docs.python.org/3.1/library/urllib.request.html#module-urllib.request">urllib</a>是一个内置在Python标准库中的模块，并使用<code>http.client</code>来实现HTTP和HTTPS协议的客户端。</p>
</blockquote>
</li>
<li>
<p>密码学：<code>hashlib, hmac</code></p>
</li>
<li>
<p>数据压缩归档：<code>zlib,gzip,bz2,lzma,zipfile,tarfile</code>；</p>
</li>
<li>
<p>任务调度：<code>asyncio, multiprocessing, threading, concurrent, signal, subprocess, queue, select, atexit</code>：</p>
<blockquote>
<p><code>concurrent.futures</code></p>
</blockquote>
</li>
<li>
<p>程序管理：<code>importlib, inspect, typing, argparse, getopt, traceback</code>；</p>
</li>
<li>
<p>调试：<code>timeit, trace</code>；</p>
<p><a href="https://pypistats.org/top">PyPI Download Stats (pypistats.org)</a></p>
</li>
</ul>
<h3 id="第三方库"><a class="header" href="#第三方库">第三方库</a></h3>
<ul>
<li>
<p>语法格式：<code>autopep8</code>, <code>pylint</code>；</p>
</li>
<li>
<p>系统管理：<code>filelock, psutil</code></p>
</li>
<li>
<p>数值计算：<code>numpy</code>、<code>scipy</code>；</p>
</li>
<li>
<p>数据可视化：<code>matplotlib, seaborn, bokeh, plotly, pyecharts</code>；</p>
<blockquote>
<p><a href="https://blog.csdn.net/weixin_39777626/article/details/78598346">Python可视化库_As的博客-CSDN博客_python可视化</a>。</p>
</blockquote>
</li>
<li>
<p>文档生成：<a href="https://jeltef.github.io/PyLaTeX/current/index.html"><code>pylatex</code></a>, <a href="https://pypi.org/project/pdfkit/"><code>pdfkit</code></a>；</p>
</li>
<li>
<p>Web开发：<code>django, flask, tornado, requests, beatifulsoup, scrapy</code>；<code>urllib3</code>, <code>requests</code></p>
<blockquote>
<p><a href="https://docs.python-requests.org/en/master/">Requests</a>由<a href="https://urllib3.readthedocs.io/en/latest/">urllib3</a>提供支持。</p>
</blockquote>
</li>
<li>
<p>图形界面开发：<code>wxPython, PyQT, TKinter</code>；</p>
</li>
<li>
<p>命令行工具：<code>click</code>、<a href="https://github.com/Textualize/rich"><code>rich</code></a>`。</p>
</li>
<li>
<p><a href="../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5.html#%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">机器学习</a>。</p>
</li>
</ul>
<h5 id="数据处理"><a class="header" href="#数据处理">数据处理</a></h5>
<p><code>pandas</code>、<code>pandasql</code>、<code>pyarrow</code>、<code>dask</code>；</p>
<p>使用<code>conda</code>安装时<code>pyarrow</code>，默认的仓库安装版本较旧（<code>0.15</code>），导致兼容问题，因此使用<code>conda-forge</code>通道。</p>
<pre><code class="language-python">conda install -c conda-forge pyarrow
</code></pre>
<pre><code class="language-python">conda install dask
pip install &quot;dask[complete]&quot;    # Install everything
</code></pre>
<p>Pandas：</p>
<pre><code class="language-python">pd.show_versions()   # 查看系统环境、pandas版本及其依赖包的版本
</code></pre>
<pre><code class="language-python">pd.io.parquet.get_engine('auto')   # 获取parquet读写引擎
</code></pre>
<blockquote>
<p>引入<code>pandas</code>包后立即调用该方法，解决与<code>matlab.engine</code>的环境冲突。</p>
</blockquote>
<h3 id="visual-studio"><a class="header" href="#visual-studio">Visual Studio</a></h3>
<p>安装Python工作负载；</p>
<p>安装Python/Conda虚拟环境；</p>
<p>通过Python环境窗口，安装或卸载包或启动交互式Python命令环境；</p>
<img src="Python开发环境.assets/image-20210522085526208.png" alt="image-20210522085526208" style="zoom:50%;" />
<h3 id="visual-studio-codepython-extension-pack"><a class="header" href="#visual-studio-codepython-extension-pack">Visual Studio Code（Python Extension Pack）</a></h3>
<p>Conda环境未正确加载会导致某些包（例如<code>numpy</code>）无法被导入。解决方案：</p>
<ol>
<li>
<p><em>为保证终端中Conda环境自动加载（终端启动时加载），执行</em></p>
<pre><code class="language-powershell">conda init cmd.exe|powershell   # conda config --set auto_activate_base false
</code></pre>
<p>初始化文件在<code>%USER%/Documents/WindowsPowerShell/profile.ps1</code>。</p>
</li>
<li>
<p><em>在VS Code中配置Conda路径，从而使终端启动时自动激活Conda虚拟环境（<code>cmd</code>）</em>。</p>
<pre><code class="language-json">&quot;python.condaPath&quot;: &quot;C:\\tools\\miniconda3\\Scripts\\conda.exe&quot;
</code></pre>
</li>
</ol>
<blockquote>
<p>To ensure the environment is set up well from a shell perspective, one option is to use an Anaconda prompt with the activated environment to launch VS Code ==using the <code>code .</code> command==. At that point you just need to select the interpreter using the Command Palette or by clicking on the status bar.</p>
<p>Conda environments can't be automatically activated in the VS Code Integrated Terminal if the default shell is <em>set to PowerShell</em>. </p>
<p><a href="https://github.com/microsoft/vscode-python/issues/11638">PowerShell does not support automatic activation of conda virtual environment · Issue #11638 · microsoft/vscode-python (github.com)</a></p>
</blockquote>
<p>忽略单行警告，在行末添加声明。如果要忽略同一文件，则将声明置于单独行。</p>
<pre><code class="language-python">import config.logging_settings  # type: ignore   =&gt; pylance
import config.logging_settings  # pylint: disable=unused-import
</code></pre>
<blockquote>
<p><code>pylint</code>可以放在<code>type</code>标记后。</p>
</blockquote>
<p>全局忽略警告：</p>
<pre><code class="language-json">&quot;python.linting.pylintArgs&quot;: [
    &quot;--disable=unused-import&quot;,
    &quot;--disable=too-few-public-methods&quot;
]  // =&gt; pylint
&quot;python.analysis.diagnosticSeverityOverrides&quot;: {
    &quot;reportUnusedImport&quot;: &quot;information&quot;,
    &quot;reportMissingImports&quot;: &quot;none&quot;
}  // ==&gt; pylance
</code></pre>
<blockquote>
<p>Pylance和pylint可同时启用，因此需要设置两项配置。</p>
</blockquote>
<p>Better Comments插件：有5中类型的注释高亮，分别用符号<code>* ? ! //todo</code>来区分。</p>
<h5 id="自动补全和语法分析配置"><a class="header" href="#自动补全和语法分析配置">自动补全和语法分析配置</a></h5>
<pre><code class="language-json">{
   &quot;python.autoComplete.extraPaths&quot;: [
      &quot;/home/gary/dataproc/dataproc/lib&quot;
   ],
   &quot;python.analysis.extraPaths&quot;: [
      &quot;/home/gary/dataproc/dataproc/lib&quot;
   ]
}
</code></pre>
<h4 id="单元测试"><a class="header" href="#单元测试">单元测试</a></h4>
<p>可将项目目录下的一个文件夹设置为单元测试目录（如<code>test</code>）；单元测试脚本需要位于该目录下，以<code>test_*.py</code>模式保存的文件将被自动发现为测试脚本<sup class="footnote-reference"><a href="#vsctest">1</a></sup>。单元测试环境会自动将测试目录和当前项目目录加入<code>PYTHONPATH</code>。</p>
<blockquote>
<p><strong>Tip</strong>: Sometimes tests placed in subfolders aren't discovered because such test files cannot be imported. To make them importable, create an empty file named <code>__init__.py</code> in that folder. （为每一级测试目录创建<code>__init__.py</code>测试路径可被识别为包）</p>
<p>由于测试目录位于搜索路径的最前，因此应该避免测试目录中包含与系统模块或用户模块同名的文件或文件夹（导致其屏蔽系统/用户模块的导入）。</p>
</blockquote>
<h5 id="单元测试项自动发现"><a class="header" href="#单元测试项自动发现">单元测试项自动发现</a></h5>
<p>如果单元测试脚本中包含错误（无法捕获异常），则在发现阶段会将其分类的错误测试项一栏（完整错误日志可在Python输出窗口中查看）；解决错误后会自动更新到对应的测试目录树下。</p>
<h4 id="在vs-code中使用jupyter-notebook"><a class="header" href="#在vs-code中使用jupyter-notebook">在VS Code中使用Jupyter Notebook</a></h4>
<p>需要安装<code>ipykernel</code>以启动内核。</p>
<h3 id="jupyter"><a class="header" href="#jupyter">Jupyter</a></h3>
<h5 id="安装"><a class="header" href="#安装">安装</a></h5>
<pre><code class="language-shell">conda create -n jupyterlab -c conda-forge {jupyterlab|jupyterhub}
conda install -c conda-forge ipywidgets jupyterhub-idle-culler
</code></pre>
<h4 id="jupyterlab"><a class="header" href="#jupyterlab">JupyterLab</a></h4>
<h5 id="路径信息"><a class="header" href="#路径信息">路径信息</a></h5>
<p><code>jupyter --path</code>配置文件、数据等的默认路径（以下给出首选路径）。</p>
<pre><code class="language-shell">config:
    $HOME/.jupyter 
data:
    $HOME/.local/share/jupyter
runtime:
    $HOME/.local/share/jupyter/runtime
</code></pre>
<p>生成配置文件：配置文件中包含默认值（可进行修改）</p>
<pre><code class="language-shell">jupyter lab --generate-config  # -&gt; $HOME/.jupyter/jupyter_lab_config.py
</code></pre>
<p>网络配置</p>
<pre><code class="language-python">c.ServerApp.base_url='/analyze/jupyter'
c.ServerApp.ip = 'localhost' # --ip=0.0.0.0
c.ServerApp.port = 0         # --port=8888
</code></pre>
<blockquote>
<p>如果使用代理出现403错误，尝试设置<code>c.ServerApp.disable_check_xsrf=True</code>禁用<em>cross-site-request-forgery</em>检查。</p>
</blockquote>
<p><a href="../%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E8%BD%AF%E4%BB%B6.html#Nginx">NGINX</a>反向代理JupyterLab服务，参考<a href="#JupyterHub%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE">JupyterHub反向代理配置</a>。</p>
<p>运行环境配置</p>
<pre><code class="language-python">c.ServerApp.root_dir='~/jupyter'
c.ServerApp.allow_root = False   # --allow-root: Allow the server to be run from root.
c.ServerApp.autoreload = True    # --autoreload
c.ServerApp.open_browser = False # --no-browser
</code></pre>
<p>安全配置</p>
<pre><code class="language-python">c.ServerApp.allow_origin = '*'
c.ServerApp.certfile = ''
c.ServerApp.keyfile = ''
c.ServerApp.cookie_secret = b''
c.ServerApp.cookie_secret_file = ''
c.ServerApp.password = ''   # from jupyter_server.auth import passwd; passwd()
</code></pre>
<h5 id="启动jupyterlab服务"><a class="header" href="#启动jupyterlab服务">启动JupyterLab服务</a></h5>
<p>以系统服务启动：</p>
<pre><code class="language-ini">[Service]
Type=simple
Environment=&quot;WORKDIR=/home/ml/jupyterlab&quot;
Environment=&quot;LOGDIR=/var/log/jupyterlab&quot;
ExecStartPre=/usr/bin/mkdir -p /tmp/jupyter $WORKDIR
ExecStart=/usr/local/miniconda3/envs/jupyter/bin/jupyter lab $OPTIONS \
          &gt; ${LOGIDR}/server.log 2&gt; ${LOGIDR}/server.error.log
TimeoutSec=10
ExecStop=/bin/kill -s TERM $MAINPID
User=ml
</code></pre>
<h4 id="jupyterhub"><a class="header" href="#jupyterhub">JupyterHub</a></h4>
<h5 id="系统架构"><a class="header" href="#系统架构">系统架构</a></h5>
<img src="Python开发环境.assets/jhub-fluxogram.jpeg" alt="JupyterHub subsystems" style="zoom: 50%;" />
<p>Jupyter系统组件包括：</p>
<ul>
<li><strong>HTTP Proxy</strong>：代理用户请求，对外的唯一的Web接口；</li>
<li><strong>Hub</strong>：</li>
<li><strong>Spawners</strong>：管理用户服务；</li>
<li><strong>Authenticator</strong>：用户鉴权组件。</li>
</ul>
<p>各个服务通过HTTP进行通信，因此可以分离部署。</p>
<blockquote>
<p><em>Connections to user servers go through the proxy, and not the hub itself. If the proxy stays running when the hub restarts (for maintenance, re-configuration, etc.), then user connections are not interrupted. For simplicity, by default the hub starts the proxy automatically, so if the hub restarts, the proxy restarts, and user connections are interrupted. It is easy to run the proxy separately, for information see the separate proxy page.</em></p>
</blockquote>
<pre><code class="language-shell">jupyterhub token|upgrade-db -h
</code></pre>
<h5 id="配置jupyterhub"><a class="header" href="#配置jupyterhub">配置JupyterHub</a></h5>
<p>推荐以下安装配置：</p>
<ul>
<li><code>/srv/jupyterhub</code> for all security and runtime files</li>
<li><code>/etc/jupyterhub</code> for all configuration files</li>
<li><code>/var/log</code> for log files</li>
</ul>
<p>生成并修改配置文件（默认输出到当前目录，使用<code>-f</code>选项指定输出目录）。</p>
<pre><code class="language-shell">jupyterhub --generate-config -f /etc/jupyterhub/jupyterhub_config.py  
jupyterhub -h,--help-all   # 列出所有命令行配置项
configurable-http-proxy -h # 代理配置项
</code></pre>
<p>除了上述命令列出的配置项外，所有配置项均可通过命令行选项进行配置以覆盖配置文件中的对应配置项。</p>
<pre><code class="language-shell">--Class.trait='value'  # c.Class.trait in [jupyterhub_config.py]
</code></pre>
<p>验证配置：</p>
<pre><code class="language-shell">jupyterhub --show-config -f config_file  # 列出当前生效的配置(仅非默认值项)
</code></pre>
<h5 id="数据存储配置"><a class="header" href="#数据存储配置">数据存储配置</a></h5>
<pre><code class="language-python">c.JupyterHub.data_files_path = '/usr/local/share/jupyterhub'
c.JupyterHub.db_url = 'sqlite:////var/lib/jupyterhub/jupyterhub.sqlite'
</code></pre>
<blockquote>
<p>在读取配置文件时：<code>sqlite:///</code>视为相对路径，绝对路径需要使用<code>sqlite:////</code>。</p>
</blockquote>
<h5 id="jupyterhub网络配置"><a class="header" href="#jupyterhub网络配置">JupyterHub网络配置</a></h5>
<p><code>bind_url</code>配置JupyterHub代理服务（用户的Web访问地址，代替弃用的<code>ip</code>、<code>port</code>和<code>base_url</code>）。省略IP则监听所有地址接收的请求，默认URL根路径为<code>/</code>。</p>
<pre><code class="language-python">c.JupyterHub.bind_url='http://:8000/'  # --url
</code></pre>
<p><code>api_url</code>配置REST API接口的访问地址（Hub服务通过该接口与代理服务通信）。</p>
<pre><code class="language-python">c.ConfigurableHTTPProxy.api_url = 'http://localhost:8001' 
</code></pre>
<p><code>hub_bind_url</code>配置Hub服务的访问地址（代理与Spawners通过该地址与Hub通信，代替<code>hub_ip</code>和<code>hub_port</code>）。<code>hub_connect_url</code>用于分离部署时指定Hub服务的地址（代替<code>hub_connect_ip</code>/<code>hub_connect_port</code>）。</p>
<pre><code class="language-python">c.JupyterHub.hub_bind_url = 'http://localhost:8081'
c.JupyterHub.hub_connect_url = 'http://hub_ip:8081'
</code></pre>
<p><a href="https://jupyterhub.readthedocs.io/en/stable/reference/config-proxy.html#nginx">外部nginx反向代理</a>：</p>
<pre><code class="language-nginx">map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}
server {
  location /jupyterhub {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;  #  $http_host for http connection
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    # websocket headers
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
    proxy_set_header X-Scheme $scheme;

    proxy_buffering off;
  }
}
</code></pre>
<p>Spawner网络配置：</p>
<pre><code class="language-python">c.Spawner.ip = '127.0.0.1'
c.Spawner.port = 0
</code></pre>
<p>使用SSL：</p>
<pre><code class="language-shell">--ssl-key my_ssl.key   # c.JupyterHub.ssl_key = '/path/to/my.key'
--ssl-cert my_ssl.cert # c.JupyterHub.ssl_cert = '/path/to/my.cert'
</code></pre>
<blockquote>
<p>使用<code>jupyterhub --generate-certs</code>生成自签名证书和私钥。</p>
</blockquote>
<h5 id="用户访问控制"><a class="header" href="#用户访问控制">用户访问控制</a></h5>
<p>配置JupyterHub用户</p>
<pre><code class="language-python">c.Authenticator.allowed_users = {'mal', 'zoe', 'inara', 'kaylee'} # 初始化用户集合
c.Authenticator.admin_users = {'mal', 'zoe'}
</code></pre>
<blockquote>
<p><em>if <code>allowed_users</code> is not set, then all authenticated users will be allowed into your hub.</em></p>
</blockquote>
<p>可选：使用系统用户进行鉴权：<em>creating that user via the system <code>adduser</code> command line tool.</em></p>
<pre><code class="language-python">c.LocalAuthenticator.create_system_users = True
# PAMAuthenticator -&gt; LocalAuthenticator -&gt; Authenticator
</code></pre>
<blockquote>
<p><em>This approach is not recommended when running JupyterHub in situations where JupyterHub users map directly onto the system’s UNIX users.</em></p>
</blockquote>
<p>自动创建用户可能会失败（CentOS7），可提前创建系统用户并进行初始化。</p>
<pre><code class="language-shell">allowed_users=(mal zoe inara)
for u in &quot;${users[@]}&quot;; do
    useradd -m -g ml $u;     # 添加用户并添加到预定义的组
    if [ $? -eq 0 ]; then    # 为新用户设置默认密码（用于JupyterHub初始登录验证，登陆后修改密码）
        passwd $u --stdin &lt;&lt;&lt; '1234abcd'
    fi
    cat /etc/passwd | grep --color=always $u  # 显示用户基本信息
done
</code></pre>
<p>Hub和Proxy（<code>ConfigurableHTTPProxy </code>）之间通过一个<code>secret token</code>来验证请求。此令牌可通过<code>openssl</code>生成，保存在配置文件或环境变量中。如果未设置，则Hub会自动随机生成一个，那么重启Hub的同时需要重启Proxy。</p>
<pre><code class="language-shell">c.ConfigurableHTTPProxy.api_token = 'abc123...def' 
export CONFIGPROXY_AUTH_TOKEN=$(openssl rand -hex 32)
</code></pre>
<p><code>cookie secret</code>用于对浏览器中用于鉴权的Cookies信息进行加密，可通过<code>openssl</code>生成。</p>
<pre><code class="language-shell">openssl rand -hex 32 &gt; /srv/jupyterhub/jupyterhub_cookie_secret 
chmod 600 /srv/jupyterhub/jupyterhub_cookie_secret
export JPY_COOKIE_SECRET=$(openssl rand -hex 32)
</code></pre>
<p>有三种指定方式：配置为环境变量，在配置文件中指定该信息所在的文件或在配置文件中指定该信息。</p>
<pre><code class="language-python">c.JupyterHub.cookie_secret_file = '/srv/jupyterhub/jupyterhub_cookie_secret'
c.JupyterHub.cookie_secret = bytes.fromhex('64 CHAR HEX STRING')
</code></pre>
<blockquote>
<p>如果未配置上述任何方法，则<code>jupyterhub_cookie_secret</code>默认创建在运行JupyterHub的用户的主目录下。该文件应该仅有该用户的读写权限，否则服务不会启动。</p>
<p>使用环境变量配置的随机生成密码会在重启服务时重新生成，导致所有登录会话失效。</p>
</blockquote>
<p><strong>基于角色的访问控制</strong>：<a href="https://jupyterhub.readthedocs.io/en/stable/rbac/scopes.html"><strong>Scopes</strong></a> are specific permissions used to evaluate API requests. <a href="https://jupyterhub.readthedocs.io/en/stable/rbac/roles.html"><strong>Roles</strong></a> are collections of scopes that specify the level of what a client is allowed to do. </p>
<pre><code class="language-python">c.JupyterHub.load_roles = [
 {
   'name': 'server-rights',
   'description': 'Allows parties to start and stop user servers',
   'scopes': ['servers'],
   'users': ['alice', 'bob'],
   'services': ['idle-culler'],
   'groups': ['admin-group'],
 }
]
</code></pre>
<p><a href="https://jupyterhub.readthedocs.io/en/stable/rbac/use-cases.html">Use Cases — Scopes in JupyterHub</a></p>
<h5 id="配置用户后台服务"><a class="header" href="#配置用户后台服务">配置用户后台服务</a></h5>
<pre><code class="language-shell">c.Spawner.cmd = ['jupyterhub-singleuser']  # 后台启动命令
# c.Spawner.cmd=[&quot;jupyter-labhub&quot;]
c.Spawner.notebook_dir = '~/notebooks'     # 工作目录路径(默认为~)
</code></pre>
<blockquote>
<p><em>Since the single-user server extends the notebook server application, it still loads configuration from the jupyter_notebook_config.py config file. Each user may have one of these files in $HOME/.jupyter/. Jupyter also supports loading system-wide config files from /etc/jupyter/, which is the place to put configuration that you want to affect all of your users.</em></p>
</blockquote>
<p>修改用户的工作目录为Jupyter服务独占目录，防止与用户的其他服务的文件冲突。如果为用户配置了非默认工作目录，则需要在用户服务初始化前进行检查确认该目录存在。JupyterHub配置文件中提供了初始化过程的接口。</p>
<pre><code class="language-shell">def my_hook(spawner):
    import os,pwd,shutil
    username = spawner.user.name
    path = f'/home/{username}/notebooks'
    if not os.path.exists(path):
        os.makedirs(path, mode=0o755, exist_ok=True)
        passwd = pwd.getpwnam(username)
        os.chown(path, passwd.pw_uid, passwd.pw_gid)
        src = '/usr/local/share/jupyterhub/.bashrc'
        if os.path.exists(src):
            dest = f'/home/{username}/.bashrc'
            shutil.copy(src, dest)
            os.chown(dest, passwd.pw_uid, passwd.pw_gid)
c.Spawner.pre_spawn_hook = my_hook
</code></pre>
<blockquote>
<p>除了工作目录外，这里也附带配置了用户的Shell初始化文件（<code>.bashrc</code>中包含Python执行环境初始化，可将已有用户的Shell配置文件作为模板文件）。</p>
</blockquote>
<p>资源分配控制</p>
<pre><code class="language-python">c.JupyterHub.active_server_limit = 0
c.JupyterHub.active_user_window = 1800
c.JupyterHub.activity_resolution = 30
c.Spawner.cpu_guarantee = None
c.Spawner.cpu_limit = None
c.Spawner.mem_guarantee = None
c.Spawner.mem_limit = None
</code></pre>
<h5 id="启动jupyterhub"><a class="header" href="#启动jupyterhub">启动JupyterHub</a></h5>
<p>以系统服务运行JupyterHub：</p>
<pre><code class="language-ini">[Service]
Type=simple
Environment=&quot;PATH=/usr/local/miniconda3/envs/jupyterhub/bin:...&quot;
ExecStart=/usr/local/miniconda3/envs/jupyterhub/bin/jupyterhub -f \
          /etc/jupyterhub/jupyterhub_config.py
TimeoutSec=10
ExecStop=/bin/kill -s TERM $MAINPID
StandardOutput=journal
StandardError=journal
SyslogIdentifier=JupyterHub
User=root
</code></pre>
<p>使用管理员权限运行JupyterHub可允许多用户登录。</p>
<blockquote>
<p><a href="https://github.com/jupyterhub/jupyterhub/wiki/Using-sudo-to-run-JupyterHub-without-root-privileges">Using sudo to run JupyterHub without root privileges · jupyterhub/jupyterhub Wiki (github.com)</a></p>
</blockquote>
<h4 id="jupyter-docker-stack"><a class="header" href="#jupyter-docker-stack">Jupyter Docker Stack</a></h4>
<p>https://jupyter-docker-stacks.readthedocs.io/en/latest/</p>
<p>Docker image for Core Stacks：https://jupyter-docker-stacks.readthedocs.io/en/latest/using/selecting.html#core-stacks</p>
<blockquote>
<p>https://hub.docker.com/u/jupyter</p>
</blockquote>
<p><a href="https://jupyterhub.readthedocs.io/en/stable/quickstart-docker.html">Using Docker — JupyterHub 2.2.2 documentation</a></p>
<p><a href="https://zero-to-jupyterhub.readthedocs.io/en/latest/">Zero to JupyterHub with Kubernetes — Zero to JupyterHub with Kubernetes documentation (zero-to-jupyterhub.readthedocs.io)</a></p>
<p>JupyterLab Documentation：https://jupyterlab.readthedocs.io/en/latest/</p>
<h4 id="问题"><a class="header" href="#问题">问题</a></h4>
<ol>
<li>
<p>终端启动配置问题，无法像登录终端一样初始化：<a href="https://stackoverflow.com/questions/60073276/how-to-login-to-bash-with-current-user-and-the-users-bashrc-file-in-jupyterl">jupyter - How to login to bash with current user, and the user's .bashrc file, in jupyterlab? - Stack Overflow</a></p>
<pre><code class="language-python">c.ServerApp.terminado_settings = {'shell_command': ['/bin/bash']}
</code></pre>
</li>
</ol>
<h3 id="pycharm"><a class="header" href="#pycharm"><a href="https://www.runoob.com/w3cnote/pycharm-windows-install.html">PyCharm</a></a></h3>
<p>支持Windows、Linux和mac。</p>
<h2 id="辅助工具"><a class="header" href="#辅助工具">辅助工具</a></h2>
<p><strong>pyreadline</strong>：命令行自动补全。在Windows平台中，如果命令记录中包含中文，那么<code>pyreadline</code>在读取历史记录时采用平台相关的编码（<code>gbk</code>）会出错。可以将其源码中默认的编码方式改为<code>utf-8</code>。</p>
<pre><code class="language-python"># xxx\envs\data\lib\site-packages\pyreadline\lineeditor\history.py
for line in open(filename, 'r', encoding='utf-8'):
</code></pre>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<div class="footnote-definition" id="jupyterhub"><sup class="footnote-definition-label">2</sup></div>
<div class="footnote-definition" id="vsctest"><sup class="footnote-definition-label">1</sup>
<p><a href="https://code.visualstudio.com/docs/python/testing">Testing Python in Visual Studio Code</a>.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Python/Python编程基础.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../Python/Python数据类型.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Python/Python编程基础.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../Python/Python数据类型.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../theme/pagetoc.js"></script>
        <script type="text/javascript" src="../theme/MathJax.js"></script>
    </body>
</html>